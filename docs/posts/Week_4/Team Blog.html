<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kailyn Hogan">
<meta name="dcterms.date" content="2023-06-09">

<title>Kailyn Hogan’s DSPG Blog - Team Blog: Week Four</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Kailyn Hogan’s DSPG Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/kailyn-hogan-760095256/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Team Blog: Week Four</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Week Four</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Kailyn Hogan </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 9, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="week-four-for-the-housing-team" class="level2">
<h2 class="anchored" data-anchor-id="week-four-for-the-housing-team">Week Four for the Housing Team</h2>
</section>
<section id="ai-driven-housing-evaluation-for-rural-community-development" class="level1">
<h1>AI-Driven Housing Evaluation for Rural Community Development</h1>
<p>This blog outlines where the Housing Team is at after week four of DSPG. We have made a lot of progress in the past four weeks, and we are excited to share it with you!</p>
<section id="project-overview" class="level2">
<h2 class="anchored" data-anchor-id="project-overview">Project Overview</h2>
<p>This is the project plan we came up with the first week of DSPG. This project is intended to span over three years with DPSG, and different interns will be working on it in the coming years. Thus, the project plan is ambitious for this summer.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/Project Outline.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="problem-statement" class="level2">
<h2 class="anchored" data-anchor-id="problem-statement">Problem Statement</h2>
<p>The absence of a comprehensive and unbiased assessment of housing quality in rural communities poses challenges in identifying financing gaps and effectively allocating resources for housing improvement. Consequently, this hinders the overall well-being and health of residents, impacts workforce stability, diminishes rural vitality, and undermines the economic growth of Iowa. Moreover, the subjective nature of evaluating existing housing conditions and the limited availability of resources for thorough investigations further compound the problem. To address these challenges, there is a pressing need for an AI-driven approach that can provide a more accurate and objective evaluation of housing quality, identify financing gaps, and optimize the allocation of local, state, and federal funds to maximize community benefits.</p>
<p>Utilizing web scraping techniques to collect images of houses from various assessor websites, an AI model can be developed to analyze and categorize housing features into good or poor quality. This can enable targeted investment strategies. It allows for the identification of houses in need of improvement and determines the areas where financial resources should be directed. By leveraging AI technology in this manner, the project seeks to streamline the housing evaluation process, eliminate subjective biases, and facilitate informed decision-making for housing investment and development initiatives in rural communities</p>
</section>
<section id="goals-and-objectives" class="level2">
<h2 class="anchored" data-anchor-id="goals-and-objectives">Goals and Objectives</h2>
<ol type="1">
<li><p>Image Gathering</p>
<ul>
<li><p>Zillow</p></li>
<li><p>Realtors.com</p></li>
<li><p>County Assessor Pages</p>
<ul>
<li><p>Vangaurd: Independence</p></li>
<li><p>Beacon Schneider: Slater, New Hampton, and Grundy Center</p></li>
</ul></li>
</ul></li>
<li><p>Build, Train, and Test AI Models</p>
<ol type="1">
<li><p>Vegetation Model</p></li>
<li><p>Siding Model</p></li>
<li><p>Gutter Model</p></li>
</ol></li>
<li><p>Create Database of Housing Information</p>
<ul>
<li><p>Zillow</p></li>
<li><p>Realtors.com</p></li>
<li><p>County Assessor Pages</p>
<ul>
<li><p>Vanguard: Independence</p></li>
<li><p>Beacon Schneider: Slater, New Hampton, and Grundy Center</p></li>
</ul></li>
</ul></li>
</ol>
</section>
<section id="our-progress" class="level2">
<h2 class="anchored" data-anchor-id="our-progress">Our Progress</h2>
<p>We have been making good progress to complete the goals and objectives we outlined above. Since the beginning of the Data Science for the Public Good Program, we have been expanding our knowledge of data science, particularly in areas that relate to this housing project. We have been learning and covering new concepts through Data Camp. We have also watched two webinars on TidyCensus training, as well as started creating AI Models to practice with.</p>
<section id="data-camp-training" class="level3">
<h3 class="anchored" data-anchor-id="data-camp-training">Data Camp Training:</h3>
<ol type="1">
<li><p>GitHub Concepts</p></li>
<li><p>AI Fundamentals</p></li>
<li><p>Introduction to R</p></li>
<li><p>Intermediate R</p></li>
<li><p>Introduction to the Tidyverse</p></li>
<li><p>Web Scraping in R</p></li>
<li><p>Introduction to Deep Learning with Keras</p></li>
</ol>
</section>
<section id="tidycensus-demographic-data-collection" class="level3">
<h3 class="anchored" data-anchor-id="tidycensus-demographic-data-collection">TidyCensus Demographic Data Collection:</h3>
<p>One of the first steps in our project was to explore the available demographic data in our selected cities and counties. We thought it valuable to understand the demographic data, and we have represented in the plots below:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/TidyCensus Training/Percentage of Population Unemployed.png" class="img-fluid figure-img" width="500"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/TidyCensus Training/Percentage of Education Levels.png" class="img-fluid figure-img" width="500"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/TidyCensus Training/Percent of Foreign Born, Non Citizen.png" class="img-fluid figure-img" width="500"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/TidyCensus Training/Median Income by Household.png" class="img-fluid figure-img" width="500"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/TidyCensus Training/medianIncome_withMoe.png" class="img-fluid figure-img" width="500"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/TidyCensus Training/Median Age.png" class="img-fluid figure-img" width="500"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/TidyCensus Training/Population by Age and Tenure, New Hampton.png" class="img-fluid figure-img" width="500"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/TidyCensus Training/Population by Age and Tenure, Independence.png" class="img-fluid figure-img" width="500"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/TidyCensus Training/Population by Age and Tenure, Grundy Center.png" class="img-fluid figure-img" width="500"></p>
</figure>
</div>
</section>
<section id="creating-test-ai-models" class="level3">
<h3 class="anchored" data-anchor-id="creating-test-ai-models">Creating Test AI Models:</h3>
<p>The next step was creating an AI Model. We decided to create an AI Model early in the project before finishing the housing data collection so that we had a better understanding when it came to putting everything together. The AI Model below tests for vegetation in front of houses.</p>
<p><img src="Week Four Team Blog Images/Gavin's First AI Model images/MicrosoftTeams-image (6).png" class="img-fluid" width="2175"></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/Gavin's First AI Model images/MicrosoftTeams-image (5).png" class="img-fluid figure-img" width="2175"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/Gavin's First AI Model images/MicrosoftTeams-image (1).png" class="img-fluid figure-img" width="2175"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/Gavin's First AI Model images/MicrosoftTeams-image (3).png" class="img-fluid figure-img" width="2175"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/Gavin's First AI Model images/MicrosoftTeams-image (4).png" class="img-fluid figure-img" width="2175"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/Gavin's First AI Model images/MicrosoftTeams-image (2).png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="this-week" class="level3">
<h3 class="anchored" data-anchor-id="this-week">This Week:</h3>
<section id="in-person-data-collection" class="level4">
<h4 class="anchored" data-anchor-id="in-person-data-collection">In-Person Data Collection</h4>
<p>On Tuesday this week, the entire DSPG program went to Slater to practice data collection in person. The housing group took this as an opportunity to collect some housing photos on the ground to use in our AI Model later on.</p>
</section>
<section id="google-street-view-and-urls" class="level4">
<h4 class="anchored" data-anchor-id="google-street-view-and-urls">Google Street View and URLs</h4>
<p>We are getting the majority of our photos for the AI to use from Google Street View. Google has an API key that you can use to generate an image for a specific address. We spent the first half of this week pulling addresses from each of our cities and creating URLs to pull the images from Google Street View.</p>
<p>We ran into a couple of problems when doing this, the biggest of which is displayed in the images below. Because we are working with cities in rural areas, there is not Google Street View images available for every street in our cities.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/Google Street View images/MicrosoftTeams-image (1).png" class="img-fluid figure-img" width="775"></p>
<figcaption class="figure-caption">Google Street View information for Grundy Center, Iowa. For reference, population was 2,811 as of 2023.</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/Google Street View images/MicrosoftTeams-image (2).png" class="img-fluid figure-img" width="775"></p>
<figcaption class="figure-caption">Google Street View information for Slater, Iowa. For reference, population was 1,639 as of 2023.</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/Google Street View images/MicrosoftTeams-image (3).png" class="img-fluid figure-img" width="775"></p>
<figcaption class="figure-caption">Google Street View information for Independence, Iowa. For reference, population was 6,307 as of 2023.</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/Google Street View images/MicrosoftTeams-image (4).png" class="img-fluid figure-img" width="775"></p>
<figcaption class="figure-caption">Google Street View information for New Hampton, Iowa. For reference, population was 3,368 as of 2023.</figcaption>
</figure>
</div>
<p>Below is a sample from the tables we created containing the URLs to grab the images from Google Street View.</p>
<p><img src="Week Four Team Blog Images/MicrosoftTeams-image (3).png" class="img-fluid"></p>
<p><img src="Week Four Team Blog Images/MicrosoftTeams-image (4).png" class="img-fluid"></p>
</section>
<section id="web-scraping" class="level4">
<h4 class="anchored" data-anchor-id="web-scraping">Web Scraping</h4>
<p>Once we were finished collecting addresses and generating URLs, we moved on to scraping the web for more images. We decided to grab images from Zillow, Realtors.com, and the County Assessor pages for our cities. We were able to successfully scrape images from Zillow this week.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/MicrosoftTeams-image (2).png" class="img-fluid figure-img" width="1910"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/MicrosoftTeams-image (1).png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>When web scraping, we ran into a problem with blurred houses. Upon some research, we found out that some home owners pay Google to have their home blurred for Google Street View.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Example_of_Blurry_House.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>The next websites we are scraping hold the Iowa Assessors housing data for our four cities. We found a webpage that has links to every counties assessor website. The key at the bottom shows where the data is held. Yellow means the data is held by Vanguard. Blue means the data is online. For most of Iowa’s counties, this means that it is held by Beacon Schneider.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/iowa_assessors_page.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
</section>
<section id="web-scraping-issues" class="level3">
<h3 class="anchored" data-anchor-id="web-scraping-issues">Web Scraping Issues</h3>
<p>Independence had issues where the house number was listed as 100/101 and also had 100 1/2. Thankfully the function to grab the Google images ran all the way but said there were 50 errors including both addresses with two house numbers and with half signs. If you remove one of the address numbers or remove the 1/2 (basically removing the / sign) the image url still brings you to a Google image. We could possibly go back through and grab these URL’s and alter them to try and grab these addresses if necessary.</p>
<section id="happies" class="level4">
<h4 class="anchored" data-anchor-id="happies">Happies</h4>
<ul>
<li><p>had a great meeting with Erin Olson-Douglas</p></li>
<li><p>finished collecting and creating URL addresses for Google Street View images</p></li>
<li><p>Zillow owns Trulia so we don’t have to web scrape both sites :)</p></li>
<li><p>able to successfully scrape some things from Zillow !</p></li>
</ul>
</section>
<section id="crappies" class="level4">
<h4 class="anchored" data-anchor-id="crappies">Crappies</h4>
<ul>
<li><p><strong><em>Web Scraping</em></strong></p></li>
<li><p>Beacon and Vanguard have anti-web scraping protections</p></li>
<li><p>Angelina’s Excel is stupid</p></li>
</ul>
</section>
</section>
</section>
<section id="future-plans-and-next-steps" class="level2">
<h2 class="anchored" data-anchor-id="future-plans-and-next-steps">Future Plans and Next Steps</h2>
<p>Once we are able to scrape enough images off of Zillow, Realtors.com, and the assessor pages, we will be able to move on with creating AI Models. The diagram below outlines how the AI Models will work in the next steps of out project.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Week Four Team Blog Images/MicrosoftTeams-image.png" class="img-fluid figure-img"></p>
</figure>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>